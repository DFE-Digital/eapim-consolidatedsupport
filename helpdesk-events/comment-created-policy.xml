<policies>
  <inbound>
    <check-header name="Authorization" failed-check-httpcode="401" ignore-case="false">
      <value>{{helpdesk-events-basic-auth-digest}}</value>
    </check-header>
    <choose>
      <when condition="@(context.Request.OriginalUrl.Query.GetValueOrDefault("escalated") == "true")">
        <!-- Send to Escalated Dispatcher -->
        <set-backend-service base-url="{{esccommentlogicapp-baseUrl}}" />
        <rewrite-uri template="{{esccommentlogicapp-rewriteUrl}}" />
      </when>
      <otherwise>
        <!-- Send to regular Comment Created Dispatcher -->
        <set-backend-service base-url="{{commentdisp-baseUrl}}" />
        <rewrite-uri template="{{commentdisp-rewriteUrl}}" />
      </otherwise>
    </choose>
    <set-method>POST</set-method>
    <set-header name="Ocp-Apim-Subscription-Key" exists-action="delete" />
    <set-header name="Authorization" exists-action="delete" />
    <set-query-parameter name="escalated" exists-action="delete" />
  </inbound>
  <backend>
    <base />
  </backend>
  <outbound>
    <base />
  </outbound>
  <on-error>
    <base />
  </on-error>
</policies>